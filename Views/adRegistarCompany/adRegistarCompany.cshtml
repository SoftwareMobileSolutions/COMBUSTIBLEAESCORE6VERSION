@{
    Layout = null;
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ValesCombustible - Registro empresas</title>
    <link rel="stylesheet" href="@Url.Content("~/lib/bootstrap/css/bootstrap.min.css")" />

    <script src="@Url.Content("~/js/jquery-3.3.1.min.js")"></script>
    <script src="@Url.Content("~/js/bootstrap.min.js")"></script>

    @*<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">*@
    <link rel="stylesheet" href="@Url.Content("~/lib/bootstrap-icons/font/bootstrap-icons.min.css")" />
    <script src="@Url.Content("~/lib/swalert/sweetalert2.min.js")"></script>
    <link href="@Url.Content("~/lib/swalert/sweetalert2.min.css")" rel="stylesheet" />
    <script src="@Url.Content("~/js/popper.min.js")"></script>
    <link href="@Url.Content("~/css/bootstrap.min.css")" rel="stylesheet" />
    <link href="@Url.Content("~/css/materialdatetimepicker.css")" rel="stylesheet" />
    <link rel="icon" type="image/png" href="@Url.Content("~/images/favicon.ico")" sizes="32x32">

</head>
<body>
    <div class="" id="loader_screen">
    </div>
    <section class="gradient-form d-flex align-items-center">
        <div class="container-fluid">          
            <div class="row">
                <div class="col-lg-8 offset-lg-2">
                    <form class="card">
                        <div class="row">
                            <div class="col-lg-12">
                                <h2 class="text-center mt-lg-5">Registro de empresa</h2>
                            </div>
                        </div>
                        <div class="card-body p-lg-4 mx-md-4 row">
                            <div class="col-lg-6 p-4 ">
                                <h4 class="text-center">Información de Usuario Administrador</h4>

                                <div class="form-outline mb-4">
                                    <label class="form-label" for="">Nombre<span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="name"
                                           placeholder="Ingresa tu nombre" />

                                </div>

                                <div class="form-outline mb-4">
                                    <label class="form-label" for="">Apellido<span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="lastname" placeholder="Ingresa tu Apellido" />

                                </div>
                                <div class="form-outline mb-4">
                                    <label class="form-label" for="">Username<span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="username" placeholder=" Ingresa tu username " />

                                </div>

                                <div class="form-outline mb-4">
                                    <label class="form-label" for="">Correo electrónico<span class="text-danger">*</span></label>
                                    <input type="email" id="email" class="form-control" placeholder=" Ingresa tu correo" />

                                </div>
                                <div class="form-outline mb-4">
                                    <label class="form-label" for="">Contraseña<span class="text-danger">*</span></label>
                                    <div class="input-group border rounded p-0 show_hide_password">
                                        <input type="password" id="password" class="form-control border-0"
                                               placeholder="Ingresa tu contraseña" />
                                        <div class="input-group-addon px-lg-2">
                                            <a href="" class="align-middle mx-lg-auto">
                                                <i class="bi bi-eye-fill align-middle mx-lg-auto" style="color:grey;"></i>
                                            </a>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-outline mb-4">
                                    <label class="form-label" for="">Repite tu contraseña<span class="text-danger">*</span></label>
                                    <div class="input-group border rounded p-0 show_hide_password">
                                        <input type="password" id="paswordRepite" class="form-control border-0"
                                               placeholder="Repite tu contraseña" />
                                        <div class="input-group-addon px-lg-2">
                                            <a href="" class="align-middle mx-lg-auto">
                                                <i class="bi bi-eye-fill align-middle mx-lg-auto" style="color:grey;"></i>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-6 p-4 " >
                                <h4 class="text-center">Información de Empresa</h4>
                                <div class="form-outline mb-4">
                                    <label class="form-label" for="">Nombre de la empresa<span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="CompanyName" placeholder=" Ingresa el nombre de la empresa" />

                                </div>

                                <div class="form-outline mb-4">
                                    <label class="form-label" for="">Dirección de empresa<span class="text-danger">*</span></label>
                                    <input type="email" class="form-control" id="adrress" placeholder=" Ingresa la dirección de la empresa" />

                                </div>

                            </div>
                        </div>
                        <div class="row mb-4">                         
                            <div class="col-lg-4 offset-lg-1">
                                <a class="btn btn-success w-100 text-light" href="@Url.Action("Login", "Login")"> Cancelar </a>
                            </div>
                            <div class="col-lg-4 offset-lg-2">
                                <input type="button" class="btn btn-light gradient-custom w-100" id="btn_create" value="Crear usuario" style="color:white;" />
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </section>
</body>
</html>
<script type="text/javascript"> 
    (function () {
        $.extend({
            form: {
                //form_valid: true,
                validaciones: function () {//Función para validar los datos de la creación de la compañia              
                    var _this = this;
                    var validEmail = /^\w+([.-_+]?\w+)*@@\w+([.-]?\w+)*(\.\w{2,10})+$/;//Regex para validar el correo electronico
                    var securePassword = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)\S{8,}$/;

                    if ($("#name").val().trim() === "") {//Se valida que se digito un nombre
                        _this.alert("Campo de texto vacio", "Debe digitar su primer nombre");
                        return false
                    }
                    if ($("#lastname").val().trim() === "") {//Se valida que se digito un apellido
                        _this.alert("Campo de texto vacio", "Debe digitar su primer apellido");
                        return false
                    }
                    if ($("#username").val().trim() === "") {//Se valdia que se digito el username
                        _this.alert("Campo de texto vacio", "Debe digitar su nombre de usuario");
                        return false
                    }
                    if ($("#email").val().trim() === "") {//Se valida si se digitó el correo electronico
                        _this.alert("Campo de texto vacio", "Debe digitar su correo eléctronico");
                        return false
                    }
                    if (!validEmail.test($("#email").val().trim())) {//Se valida si se digito un correo valido 
                        _this.alert("Formato de correo incorrecto", "Debe digitar  un correo valido")
                        return false
                    }
                    if ($("#CompanyName").val().trim() === "") {//Se valida si se digitó el nombre de la compañia 
                        _this.alert("Campo de texto vacio", "Debe digitar el nombre de la compañia");
                        return false
                    }
                    if ($("#adrress").val().trim() === "") {//Se valida si se digitó la dirección de la empresa
                        _this.alert("Campo de texto vacio", "Debe digitar la direcciíon de la compañia");
                        return false
                    }
                    if ($("#password").val().trim() === "") {//Se valida si se digito la contraseña 
                        _this.alert("Campo de texto vacio", "Debe digitar su contraseña");
                        return false
                    }
                    if ($("#password").val().trim() < 8) {//Se valida el largo de la contraseña
                        _this.alert("Contraseña demasiado corta", "Debe digitar una contraseña de almenos 8 caracteres");
                        return false
                    }
                    /*if (!securePassword.test($("#password").val().trim())) {
                        _this.alert("Contraseña insegura", "Su contraseña debe contener una o mas mayusculas, una o mas minusculas, uno o mas digitos y mas de 8 caracteres ")
                        return false
                    }*/

                    if ($("#paswordRepite").val().trim() != $("#password").val().trim()) {//Se valida si se repitió la contraseña
                        _this.alert("Contraseña incorrecta", "Deber repertir la contraseña que ya tiene escrita")
                        return false
                    }
                    return true

                    //var inputs = $('.form-outline input');
                    //var labels = $('.form-outline label');
                    /*for (let i = 0; i < 7; i++) { 
                        
                        if (inputs[i].value == "") {
                            _this.alert("Campo de texto vacio", "Debe ingresar su " + labels[i].innerText.toLowerCase())
                            _this.form_valid = false
                            break;
                        } 

                        if(i == 3) { 
                            _this.email();
                            if (this.form_valid == false) { 
                                break;
                            }
                        }
                        if (i == 6) { 
                            _this.secure_password();
                            if (this.form_valid == false) {
                                break;
                            }
                        }
                        
                    }*/

                    
                },            
                /*email: function () { 
                    var validEmail = /^\w+([.-_+]?\w+)*@@\w+([.-]?\w+)*(\.\w{2,10})+$/;
                    var _this = this;
                    if (!validEmail.test($("#email").val())) {
                        _this.alert("Formato de correo incorrecto", "Debe ingresar  un correo valido")
                        _this.form_valid = false
                    } else {
                        _this.form_valid = true
                    }
                },
                secure_password: function () {
                    var _this = this
                    var regex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)\S{8,}$/;
                    if (!regex.test($("#password").val())) {
                        _this.alert("Contraseña insegura", "Su contraseña debe contener una o mas mayusculas, una o mas minusculas, uno o mas digitos y mas de 8 caracteres ")
                        _this.form_valid = false;
                    } else {
                        _this.repeate_password();
                    }
                },
                repeate_password: function () {
                    var _this = this
                    if ($("#paswordRepite").val() != $("#password").val()) {
                        _this.alert("Contraseña incorrecta", "Deber repertir la contraseña que ya tiene escrita")
                        _this.form_valid = false;
                    } else {
                        _this.form_valid = true;
                    }
                },*/
                alert: function (title, text) {//Función para mostrar alertas
                    Swal.fire({
                        icon: "warning",
                        title: title,
                        text: text,
                    });
                },
                showPassword: function () {//Función para mostrar la contraseña
                    $(".show_hide_password a").on('click', function (event) {
                        event.preventDefault();
                        if ($('.show_hide_password input').attr("type") == "text") {
                            $('.show_hide_password input').attr('type', 'password');
                            $('.show_hide_password i').removeClass("bi bi-eye-slash-fill");
                            $('.show_hide_password i').addClass("bi bi-eye-fill");
                        } else if ($('.show_hide_password input').attr("type") == "password") {
                            $('.show_hide_password input').attr('type', 'text');
                            $('.show_hide_password i').addClass("bi bi-eye-slash-fill");
                            $('.show_hide_password i').removeClass("bi bi-eye-fill");

                        }
                    });
                },
                create_btn: function () {//Función que crea la company
                    var _this = this;
                    $("#btn_create").on('click', function () {
                        /*let args = {
                            Name: $("#name").val(),
                            LastName: $("#lastname").val(),
                            username: $("#username").val(),
                            password: $("#password").val(),
                            email: $("#email").val(),
                            companyName: $("#CompanyName").val(),
                            companyAdress: $("#adrress").val()
                        }
                        $.get("@Url.Action("registerCompany", "Register")", args, function (datos) {
                            if (datos.bandera == 0) {
                                _this.alert("Usuario invalido", datos.resultado);
                            } else {
                                Swal.fire({
                                    title: "Usuario credo con exito",
                                    text: datos.resultado,
                                    icon: "success"
                                }).then((result) => {
                                    if (result.isConfirmed) {
                                        console.log("El usuario ha hecho clic en el botón OK");
                                        window.location = "@Url.Action("Login", "Login")";
                                    }
                                });
                            }
                        });*/
                        if (_this.validaciones() === true) {

                            let args = {
                                Nombre: $("#name").val().trim(),
                                Apellido: $("#lastname").val().trim(),
                                Username: $("#username").val().trim(),
                                Clave: $("#password").val().trim(),
                                Correo: $("#email").val().trim(),
                                NombreCompany: $("#CompanyName").val().trim(),
                                DireccionCompany: $("#adrress").val().trim()
                            }
                            $("#loader_screen").addClass("loader")
                            $.post("@Url.Action("registerCompany", "adRegistarCompany")", args, function (datos) {
                                $("#loader_screen").removeClass("loader")
                                if (datos.bandera == 0) {
                                    _this.alert("Usuario invalido", datos.resultado);
                                } else {
                                    Swal.fire({
                                        title: "Usuario credo con exito",
                                        text: datos.resultado,
                                        icon: "success",
                                        allowOutsideClick: false
                                    }).then((result) => {
                                        if (result.isConfirmed) {
                                            @*console.log("El usuario ha hecho clic en el botón OK");*@
                                            window.location = "@Url.Action("Login", "Login")";
                                        }
                                    });
                                }
                            });
                        }
                       
                    });
                
                }
            },
            home_init: function () {//Funciones que se ejecutan al entrar al modulo
                var _this = this;
                _this.form.showPassword();
                _this.form.create_btn();
                
            }
        })
        $.home_init();
    })();
</script>

<style type="text/css">
    section {
        background: url(@Url.Content("~/images/1.jpg"));
        background-position:center;
        background-repeat: no-repeat;
        background-size:cover;
        height: 100vh !important;
    }

    .form-control:focus {    
        box-shadow: blue !important;     
    }

    .gradient-custom {
        color: white !important;
        background: #fccb90;
        /* Chrome 10-25, Safari 5.1-6 */
        background: -webkit-linear-gradient(to right, #ee7724, #d8363a, #dd3675, #b44593);
        /* W3C, IE 10+/ Edge, Firefox 16+, Chrome 26+, Opera 12+, Safari 7+ */
        background: linear-gradient(to right, #ee7724, #d8363a, #dd3675, #b44593);
    }

    .loader {
        position: fixed;
        left: 0px;
        top: 0px;
        width: 100%;
        height: 100%;
        z-index: 9999;
        background: url(@Url.Content("~/images/loading_img.gif")) 50% 50% no-repeat rgb(249,249,249);
        background-size: 75px 75px;
        opacity: .8;
    }

</style>


